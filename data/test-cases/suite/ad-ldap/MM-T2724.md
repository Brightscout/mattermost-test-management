---
key: MM-T2724
title: User exists in SAML but that email address doesn't have active LDAP account (but then are re-added in LDAP)
---

## MM-T2724: User exists in SAML but that email address doesn't have active LDAP account (but then are re-added in LDAP)

### Details

| Name     | Value                |
| :------- | :------------------- |
| Priority | Normal               |
| Status   | Draft                |
| Folder   | Suite / AD LDAP      |
| Labels   | ldap                 |
| Created  | 2020-06-01T17:46:25Z |

### Steps

<hr/>

**Step 1**

> <article>User exists in SAML but that email address doesn't have active LDAP account (but then are re-added in LDAP)<br>————————————————————————————<ul><li>With SAML enabled to sync with LDAP, user exists in SAML but that email address doesn't have an active LDAP account:<ul><li>&nbsp;Can create new in SAML that doesn't exist yet in LDAP (if there's room in LDAP to add that user there later)</li><li>OR can use an existing account but before starting, in Jumpcloud remove the user from all Groups and then from the Jumpcloud Directory (effectively disabling them; the Suspend function in Jumpcloud might not work for this)</li></ul></li><li>First: Admin ensure SAML is enabled to sync with LDAP, then in another browser (make sure not still logged into OKTA in other browser as previous test.one):<ol><li>User who has a SAML account but not an (active) LDAP account clicks the OKTA signin button and creates account in Mattermost using SAML</li><li>System admin syncs LDAP</li><li>User is auto-logged-out. They show as inactive in System Console ➜ Users (They can log back in again using SAML, but they will be deactivated again on any subsequent LDAP sync)</li><li>System admin re-activates or adds them in LDAP (be sure to use same email address as in SAML, and be sure that they are selected as active in Groups ➜ `All Users - LDAP` in Jumpcloud)</li><li>If necessary: User completes LDAP account activation</li><li>User logs back in to Mattermost using SAML and they are successfully reactivated, and exhibit attributes from OKTA</li><li>System admin syncs LDAP</li><li>User is not logged out / deactivated, and shows attributes from LDAP</li></ol></li></ul></article>

**Expected**

> <article><ul><li>Fixed: No need to purge caches:<br>https://mattermost.atlassian.net/browse/PLT-8061<br><br></li><li>If using the same user again next time, be sure to remove from Jumpcloud when this test is done</li></ul></article>

<hr/>

### More Info

| Name                     | Value          |
| :----------------------- | :------------- |
| Rainforest               | N/A            |
| Team Ownership           | Suite Users    |
| Manual Test Environments | Desktop,Webapp |
| Cypress                  | To Do          |
| Location                 | AD LDAP        |
