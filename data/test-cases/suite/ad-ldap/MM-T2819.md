---
key: MM-T2819
title: Adding users in and not-in group to team and channel via API(newline)(newline)POST(newline)https://selenium.test.mattermost.com/api/v4/teams/{teamid}/members(newline)(newline)POST(newline)https://selenium.test.mattermost.com/api/v4/channels/{channelid}/members
---

## MM-T2819: Adding users in and not-in group to team and channel via API(newline)(newline)POST(newline)https://selenium.test.mattermost.com/api/v4/teams/{teamid}/members(newline)(newline)POST(newline)https://selenium.test.mattermost.com/api/v4/channels/{channelid}/members

### Details

| Name     | Value                |
| :------- | :------------------- |
| Priority | Normal               |
| Status   | Draft                |
| Folder   | Suite / AD LDAP      |
| Labels   | ldap                 |
| Created  | 2020-06-02T20:03:50Z |

### Steps

<hr/>

**Step 1**

> <article>Adding users in and not-in group to team and channel via API<br><br>POST<br><a href="https://selenium.test.mattermost.com/api/v4/teams/{teamid}/members">https://selenium.test.mattermost.com/api/v4/teams/{teamid}/members</a><br><br>POST<br><a href="https://selenium.test.mattermost.com/api/v4/channels/{channelid}/members">https://selenium.test.mattermost.com/api/v4/channels/{channelid}/members</a><br>————————————————————————————<ol><li>Login to a server with groups configured with the QA LDAP data.</li><li>Make linda.test a team admin of the "qa" team and make george.test a channel admin of the "xyz" channel.</li><li>&nbsp;Update the database to set the "qa" team and the "xyz" channel to be group-constrained = true (ask for dev help if necessary).<br>{code}</li><li>UPDATE Teams SET GroupConstrained = true WHERE Name = 'qa';</li><li>UPDATE Channels SET GroupConstrained = true WHERE Name = 'xyz';<br>{code}</li><li>&nbsp;Login as linda.test and try to add anyone outside of the qa group to the qa Mattermost team. The API should reject the request.</li><li>Add and remove lindy.test from the team to ensure that qa group members can still be added.</li><li>Login as george.test and try to add a non-xyz group member to the xyz channel. The API should reject the request.</li><li>Remove and add jesus.test from the xyz channel to ensure that xyz group members can still be added.</li></ol></article>

**Expected**

> <article>Tested as described:<br /><br />Step 4) Adding a user not in the group failed, with response &quot;Team membership denied to the following users because of group constraints: [ajojmw6m8b81frhryi8dzu7f8r]&quot;,&quot;<br />Step 5) No error adding user in the group (removing gives a general group-constraint message: &quot;Unable to remove a user from a group-constrained team.&quot;)<br />Step 6) Adding a user not in the group failed, with response &quot;Channel membership denied to the following users because of group constraints: [8fe1npdbopgyuroreaj6dr3cne]&quot;<br />Step 7) User left channel in the UI (API failed to remove with group-constraint message as with team), then was able to successfully re-add via the API that user who is in the group</article>

**Step Info**
| Name | Value |
| :--- | :--- |
| Fix Versions | v5.12 (June 2019) |
| Related ticket(s) | (<strong><span style="color: rgb(65, 168, 95);">Story</span></strong>)&nbsp;<a href="https://mattermost.atlassian.net/browse/MM-14753">Constrain APIs to not permit non-group members when team or channel is group-constrained — MM-14753</a> |

<hr/>

### More Info

| Name                     | Value             |
| :----------------------- | :---------------- |
| Fix Versions             | v5.12 (June 2019) |
| Rainforest               | N/A               |
| Team Ownership           | Suite Users       |
| Manual Test Environments | Desktop,Webapp    |
| Cypress                  | To Do             |
| Location                 | AD LDAP           |
