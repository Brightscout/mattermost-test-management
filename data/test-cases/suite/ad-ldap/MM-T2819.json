{
  "id": 5612570,
  "key": "MM-T2819",
  "name": "Adding users in and not-in group to team and channel via API\n\nPOST\nhttps://selenium.test.mattermost.com/api/v4/teams/{teamid}/members\n\nPOST\nhttps://selenium.test.mattermost.com/api/v4/channels/{channelid}/members",
  "createdOn": "2020-06-02T20:03:50Z",
  "objective": null,
  "precondition": null,
  "estimatedTime": null,
  "labels": ["ldap", "fix-versions-not-empty-2022cleanup"],
  "component": null,
  "priority": { "id": 401950, "name": "Normal" },
  "status": { "id": 401946, "name": "Draft" },
  "folder": {
    "id": 404269,
    "name": "AD LDAP",
    "parentId": 2954447,
    "fullNames": ["Suite", "AD LDAP"],
    "fullPath": "suite/ad-ldap"
  },
  "customFields": {
    "Playwright": null,
    "Authors": "",
    "Priority P1 to P4": null,
    "Update notes": "",
    "Rainforest": ["N/A"],
    "Team Ownership": ["Suite Users"],
    "Manual Test Environments": ["Desktop", "Webapp"],
    "Detox": null,
    "Cypress": "To Do",
    "MMCTL": null,
    "Last Updated": "",
    "Tags": [],
    "Location": "AD LDAP"
  },
  "steps": [
    {
      "inline": {
        "description": "Adding users in and not-in group to team and channel via API<br><br>POST<br><a href=\"https://selenium.test.mattermost.com/api/v4/teams/{teamid}/members\">https://selenium.test.mattermost.com/api/v4/teams/{teamid}/members</a><br><br>POST<br><a href=\"https://selenium.test.mattermost.com/api/v4/channels/{channelid}/members\">https://selenium.test.mattermost.com/api/v4/channels/{channelid}/members</a><br>————————————————————————————<ol><li>Login to a server with groups configured with the QA LDAP data.</li><li>Make linda.test a team admin of the \"qa\" team and make george.test a channel admin of the \"xyz\" channel.</li><li>&nbsp;Update the database to set the \"qa\" team and the \"xyz\" channel to be group-constrained = true (ask for dev help if necessary).<br>{code}</li><li>UPDATE Teams SET GroupConstrained = true WHERE Name = 'qa';</li><li>UPDATE Channels SET GroupConstrained = true WHERE Name = 'xyz';<br>{code}</li><li>&nbsp;Login as linda.test and try to add anyone outside of the qa group to the qa Mattermost team. The API should reject the request.</li><li>Add and remove lindy.test from the team to ensure that qa group members can still be added.</li><li>Login as george.test and try to add a non-xyz group member to the xyz channel. The API should reject the request.</li><li>Remove and add jesus.test from the xyz channel to ensure that xyz group members can still be added.</li></ol>",
        "testData": null,
        "expectedResult": "Tested as described:<br /><br />Step 4) Adding a user not in the group failed, with response &quot;Team membership denied to the following users because of group constraints: [ajojmw6m8b81frhryi8dzu7f8r]&quot;,&quot;<br />Step 5) No error adding user in the group (removing gives a general group-constraint message: &quot;Unable to remove a user from a group-constrained team.&quot;)<br />Step 6) Adding a user not in the group failed, with response &quot;Channel membership denied to the following users because of group constraints: [8fe1npdbopgyuroreaj6dr3cne]&quot;<br />Step 7) User left channel in the UI (API failed to remove with group-constraint message as with team), then was able to successfully re-add via the API that user who is in the group",
        "customFields": {
          "Fix Versions": ["v5.12 (June 2019)"],
          "Related ticket(s)": "(<strong><span style=\"color: rgb(65, 168, 95);\">Story</span></strong>)&nbsp;<a href=\"https://mattermost.atlassian.net/browse/MM-14753\">Constrain APIs to not permit non-group members when team or channel is group-constrained — MM-14753</a>",
          "Important notes about this step": ""
        }
      },
      "testCase": null
    }
  ],
  "caseHashed": "7e0be5790b0bf5518fc2caa82f72de71028ca3b74fdeb7b99bd66febb02df4dfb53c8849fbe72ced404df4c5a893737d",
  "stepsHashed": "7e6b359c377113f18abaf55b35b8db18ff6137a1d1973d898f26ff72decd881468b7008d730be11e08dff5b37bc4d261"
}
