---
key: MM-T3007
title: OAuth SSO: GitLab – Selenium tests (10)
---

## MM-T3007: OAuth SSO: GitLab – Selenium tests (10)

**Precondition**

> <article>AuthGitLab.html</article>

### Details

| Name     | Value                       |
| :------- | :-------------------------- |
| Priority | Low                         |
| Status   | Active                      |
| Folder   | Suite / OAuth               |
| Labels   | Se-Needs-Test-Steps,se-prod |
| Created  | 2020-07-09T05:49:09Z        |

### Steps

<hr/>

**Step 1**

> <article><strong>Account creation disabled<br></strong><br>1. With GitLab set up, set System Console &gt; Users and Teams &gt; "Enable Account Creation" to false

<br>2. Open login page in separate or incognito browser
<br>3. Click to create a new account, click to use GitLab</article>

**Expected**

> <article>Cannot create new account with SSO: error page "Error User sign-up is disabled. Back to Mattermost" <br><br>Then set account creation back to TRUE</article>

<hr/>

**Step 2**

> <article><strong>Create new account using GitLab<br></strong><br>1. Go to Main Menu &gt; Send Email Invite and send to email address associated with GitLab account (can also use team invite link and skip sending/receiving the email, or just click to create a new account if it's an open server)

<br>2. Logout
<br>3. Click the invite link in the email
<br>4. On the sign up page, click "Sign Up with GitLab"
<br>5. Sign up with a gitlab account that is not already used on the server</article>

**Expected**

> <article>Account is created and team is joined</article>

<hr/>

**Step 3**

> <article><strong>Switch GitLab SSO to email / password<br></strong><br>1. Sign in with an account using GitLab SSO

<br>2. Go to Account Settings -&gt; Security -&gt; Signin Method
<br>3. Switch to email sign in
<br>4. Observe success message
<br>5. Log back in with email</article>

**Expected**

> <article>Sign in method should switch to email and login is successful</article>

<hr/>

**Step 4**

> <article><strong>Try to log in with GitLab after changing to email / password<br></strong><br>1. After switching GitLab account to sign in using email (in test above)

2. Log out of the server and try to use your GitLab account to sign in</article>

**Expected**

> <article>Error message displays about email address already in use:

"There is already an account associated with that email address using a sign in method other than gitlab. Please sign in using email."</article>

<hr/>

**Step 5**

> <article><strong>Can switch back to GitLab login method and log in<br></strong><br>15. Log in using email / password<br>16. In Account Settings &gt; Security, switch signin method back to GitLab login<br>17. Observe success message<br>18. Log in usingGitLab</article>

**Expected**

> <article>- Login is successful using GitLab</article>

<hr/>

**Step 6**

> <article><strong>Update User Attributes in GitLab    <br></strong><br>1. Sign in using GitLab<br>2. Verify Account Settings &gt; General Settings show that username and email are set in GitLab,<br>3. Edit first and last name<br>4. Log out of Mattermost<br>5. In GitLab:Update email in Profile, and username in Account. Make note of full name<br>6. Log back in to Mattermost using GitLab</article>

**Expected**

> <article>Full name, username and email in Account Settings update to match what's in GitLab<br><br>Email may not update until after it's verified depending on System Console setting re: email verification<br><br>(Could then click in verification email to verify new email address, and verify in Mattermost that email address updated)</article>

<hr/>

**Step 7**

> <article><strong>Deactivate in Mattermost, user reactivates on SSO<br></strong><br>Deactivate user in Mm, verify warning message "You must also deactivate this user in the SSO provider or they will be reactivated on next login or sync."<br><br>User re-signs in using GL<br><br>System admin refreshes viewing the user in System Console</article>

**Expected**

> <article>User is reactivated on re-signing in using GitLab</article>

<hr/>

**Step 8**

> <article><strong>GitLab Disabled -&gt; Not available for signin   <br></strong><br>1. System Console: Set ""Enable authentication with GitLab:"" = false (Team Edition), or System Console &gt; OAuth 2.0: ""Select OAuth Provider"" to Do not allow sign-in via an OAuth 2.0 provider (Enterprise)<br><br>(fields will repopulate after you set it back to GitLab, but if two OAuth methods are in place, only one of them will return to the login page)</article>

**Expected**

> <article>Team Edition: GitLab fields become uneditable, login page does not have GitLab signin button, account creation page does not have option for GitLab Sign up.<br><br>Enterprise Edition: Gitlab fields are hidden from page.</article>

<hr/>

**Step 9**

> <article><strong>GitLab Settings: Pre-populate    <br></strong><br>1. In GitLab settings, observe the GitLab Site URL<br>2. Observe the fields below it are pre-populated based on that URL and are not editable<br>3. Edit the GitLab Site URL and observe the changes in the fields below (do not save changes)</article>

**Expected**

> <article><span data-sheets-userformat='{"2":897,"3":{"1":0},"10":2,"11":4,"12":0}' data-sheets-value='{"1":2,"2":"Fields pre-populate based on Site URL and are not editable:\nUser API Endpoint\nAuth Endpoint\nToken Endpoint"}'>Fields pre-populate based on Site URL and are not editable:<br></span><br><span data-sheets-userformat='{"2":897,"3":{"1":0},"10":2,"11":4,"12":0}' data-sheets-value='{"1":2,"2":"Fields pre-populate based on Site URL and are not editable:\nUser API Endpoint\nAuth Endpoint\nToken Endpoint"}'>User API Endpoint<br>Auth Endpoint<br>Token Endpoint</span></article>

<hr/>

**Step 10**

> <article><strong>Correct message if user has not authorized MM in GitLab <br></strong><br>1. If you've already authorized GitLab to log in to the Mattermost server:<br>- Log in to GitLab (not Mm), click on the down arrow to the right of your profile icon top right &gt; Settings &gt; Applications<br>- scroll down to Authorized Applications and revoke access from the Mattermost server you're testing on (NOTE: rctesting will be listed as `MattermostTest`)<br>2. Log out your Mattermost GitLab account<br>3. On login page, click to log in using GitLab<br>4. GitLab login page appears (unless you're already logged in to GitLab in the background)<br>5. Log in to GitLab (unless you're already logged in)<br>6. On the ""authorize [MM-server-name] to use your account click on ""Deny""<br>7. On the ""Authorization Error"" page, click on ""Back to log in page""<br>8. Observe error page displaying "Authorization Error - You must authorize Mattermost to log in with Gitlab. - Back to login page"<br>9. Click to log in using GitLab<br>10. Click to Authorize<br>11. Attempt login again</article>

**Expected**

> <article>- Login is successful again after re-authorizing</article>

<hr/>

### More Info

| Name                     | Value                                  |
| :----------------------- | :------------------------------------- |
| Priority P1 to P4        | P1 - Smoke Tests (App testable?)       |
| Update notes             | Cloud Selenium: cloud-se-p1p2p3p4.html |
| Team Ownership           | Suite Users                            |
| Manual Test Environments | Automated - No manual tests needed     |
| Location                 | OAuth                                  |
