{
  "id": 9943911,
  "key": "MM-T3951",
  "name": "Circle CI Subscriptions post build results",
  "createdOn": "2021-04-03T15:52:29Z",
  "objective": null,
  "precondition": "These test require that you connect to Circle CI with a GitHub user who has access to these 2 public repos.<br>https://github.com/DHaussermann/hello-world<br>https://github.com/DHaussermann/mattermost-plugin-custom-attributes<br><br>Contact Dylan if invites are needed.<br><br><strong>Note:</strong><br>This functionality works with <em>mattermost-plugin-custom-attributes</em> because a 3rd party Orb was added in the .yaml build instructions. To make the webhook for this work with a different repo, the steps at https://github.com/nathanaelhoun/circleci-orb-mattermost-plugin-notify must be followed. &nbsp;",
  "estimatedTime": null,
  "labels": [],
  "component": null,
  "priority": { "id": 1251319, "name": "Smoke test" },
  "status": { "id": 890281, "name": "Active" },
  "folder": {
    "id": 1260737,
    "name": "Circle-CI",
    "parentId": 404330,
    "fullNames": ["Plugins", "Circle-CI"],
    "fullPath": "plugins/circle-ci"
  },
  "customFields": {
    "Playwright": null,
    "Authors": "",
    "Priority P1 to P4": null,
    "Update notes": "",
    "Rainforest": [],
    "Team Ownership": [],
    "Manual Test Environments": [],
    "Detox": null,
    "Cypress": null,
    "MMCTL": null,
    "Last Updated": "",
    "Tags": ["Never tested"],
    "Location": "Plugins"
  },
  "steps": [
    {
      "inline": {
        "description": "Create a subscription that will post if pipeline fails or succeed<br><br>1. /circleci subscription add --project gh/DHaussermann/mattermost-plugin-custom-attributes <br>2. Follow steps here <a href=\"https://circleci.com/developer/orbs/orb/nathanaelhoun/mattermost-plugin-notify\">https://circleci.com/developer/orbs/orb/nathanaelhoun/mattermost-plugin-notify</a> to add an orb to your project pipeline (or use the Custom attributes project)\n<br>3. As instructed, add the environment variable for the webhook to your project ",
        "testData": "",
        "expectedResult": "On 1. The plugin shows:<br><em>\"1. Setup the Mattermost Plugin Notify Orb for your CircleCI project <br>2. Add the MM_WEBHOOK environment variable to your project using the CircleCI UI or withPost confirms that project has been successfully set\"</em><br>On 3. /circleci project env add MM_WEBHOOK <a href=\"https://dkh-5-33-release.test.mattermost.cloud/plugins/com.github.mattermost.plugin-circleci/hooks/AXwbcu5XAgCyXWx0pUnD_V42CZLC5yFQ\">https://&lt;MM URL&gt;/plugins/com.github.mattermost.plugin-circleci/hooks/AXwbcu5XAgCyXWx0pUnD_V42CZLC5yFQ</a>",
        "customFields": {
          "Fix Versions": [],
          "Related ticket(s)": "",
          "Important notes about this step": ""
        }
      },
      "testCase": null
    },
    {
      "inline": {
        "description": "Trigger a passing build<br>1. /circleci pipeline trigger branch master<br>2. Confirm that the expected build is running on the Circle Ci side<br>3. Wait for the build to succeed&nbsp;",
        "testData": null,
        "expectedResult": "Subscription post is show with data about passing build in the channel from step 1.<br><img src=\"https://smartbear-tm4j-prod-us-west-2-attachment-rich-text.s3.us-west-2.amazonaws.com/embedded-f3277290f945470c4add5d21ef3dc7ca7b74388fc7152bfb6b99ae58c66a95a8-1617466205706-1617466205706.png\" style=\"width: 300px;\" class=\"fr-fic fr-fil fr-dib\">",
        "customFields": {
          "Fix Versions": [],
          "Related ticket(s)": "",
          "Important notes about this step": ""
        }
      },
      "testCase": null
    },
    {
      "inline": {
        "description": "Trigger a failing build (by invalidating yml configuration)<br>1. In GitHub navigate to https://github.com/DHaussermann/mattermost-plugin-custom-attributes/tree/master/.circleci and edit <em>config.yml</em><br>2. Edit line <em><strong>116</strong></em> to read <em>`name: Building Plugin <strong>hippo-</strong>Bundle`&nbsp;</em><br>3. Edit line <strong>121</strong> to read <em>`<strong>hippo-</strong>printf \"Supported Mattermost Server Versions: **$(cat plugin.json | jq .min_server_version -r)+** \\n## Enhancements\\n\\n## Fixes\\n\" &gt;&gt; dist/release-notes.md</em><br>4. Push the commit to <em>master</em>&nbsp; (Or open a PR than merge it to <em>master</em> if you lack permissions)<br>5. Return to Mattermost and type <em>/circleci pipeline trigger branch master</em><br>6. Confirm that the expected build is running on the Circle Ci side<br>7. Wait for the build to fail<br><br><br><br>",
        "testData": "<strong>Note:&nbsp;</strong><br>For steps 2. and 3. - Revert this commit after to make the build succeed again",
        "expectedResult": "Subscription post is show with data about failing build.<br><img src=\"https://smartbear-tm4j-prod-us-west-2-attachment-rich-text.s3.us-west-2.amazonaws.com/embedded-f3277290f945470c4add5d21ef3dc7ca7b74388fc7152bfb6b99ae58c66a95a8-1617466892719-1617466892719.png\" style=\"width: 300px;\" class=\"fr-fic fr-fil fr-dib\">",
        "customFields": {
          "Fix Versions": [],
          "Related ticket(s)": "",
          "Important notes about this step": ""
        }
      },
      "testCase": null
    },
    {
      "inline": {
        "description": "Delete a subscription<br>1. /circleci subscription remove --project gh/DHaussermann/mattermost-plugin-custom-attributes<br>2. /circleci subscription list<br><br>",
        "testData": "",
        "expectedResult": "Subscription is not shown",
        "customFields": {
          "Fix Versions": [],
          "Related ticket(s)": "",
          "Important notes about this step": ""
        }
      },
      "testCase": null
    },
    {
      "inline": {
        "description": "Subscribing to \"Failed build only\" shows failed builds<br>1. <em>/circleci subscription add --only-failed</em><br>2. <em>/circleci pipeline trigger branch master</em><br>3. Verify in Circle CI that the pipeline is running<br>4. Wait for the build to fail<br>5. Return to the Mattermost channel",
        "testData": "",
        "expectedResult": "Subscription post is show with data about failing build.<br><img src=\"https://smartbear-tm4j-prod-us-west-2-attachment-rich-text.s3.us-west-2.amazonaws.com/embedded-f3277290f945470c4add5d21ef3dc7ca7b74388fc7152bfb6b99ae58c66a95a8-1617466892719-1617466892719.png\" class=\"fr-fic fr-dii\"><br>",
        "customFields": {
          "Fix Versions": [],
          "Related ticket(s)": "",
          "Important notes about this step": "Build should still be in a failing state from commit made in step 3."
        }
      },
      "testCase": null
    },
    {
      "inline": {
        "description": "Subscribing to \"Failed build only\" does not show successful builds<br>1. Revert the commit made in step 3. so that the <em>config.yml</em> is once again valid<br>2. Ensure the subscription created in step 5. is still in place<br>3. Type <em>/circleci pipeline trigger branch master</em><br>3. Verify in Circle CI that the pipeline is running<br>4. Wait for the build tosucceed<br>5. Return to the Mattermost channel",
        "testData": "",
        "expectedResult": "The subscription did <strong>not </strong>make a post<br><br>",
        "customFields": {
          "Fix Versions": [],
          "Related ticket(s)": "",
          "Important notes about this step": "Build should still be in a failing state from commit made in step 3."
        }
      },
      "testCase": null
    }
  ],
  "caseHashed": "d0787a66a98ac6585fda081dab2acef7c58b77ff91879abdb2112d840d219054f654618205f99d5889e2ca8feb4ba568",
  "stepsHashed": "a688957bbae99cdf9bfefe4a0ec72e66b8a324168335ec00c61a015252cb5943eedb1797b0f89a1fa0fc3d3ad740d281"
}
