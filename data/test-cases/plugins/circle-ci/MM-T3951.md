---
key: MM-T3951
title: Circle CI Subscriptions post build results
---

## MM-T3951: Circle CI Subscriptions post build results

**Precondition**

> <article>These test require that you connect to Circle CI with a GitHub user who has access to these 2 public repos.<br>https://github.com/DHaussermann/hello-world<br>https://github.com/DHaussermann/mattermost-plugin-custom-attributes<br><br>Contact Dylan if invites are needed.<br><br><strong>Note:</strong><br>This functionality works with <em>mattermost-plugin-custom-attributes</em> because a 3rd party Orb was added in the .yaml build instructions. To make the webhook for this work with a different repo, the steps at https://github.com/nathanaelhoun/circleci-orb-mattermost-plugin-notify must be followed. &nbsp;</article>

### Details

| Name     | Value                |
| :------- | :------------------- |
| Priority | Smoke test           |
| Status   | Active               |
| Folder   | Plugins / Circle-CI  |
| Created  | 2021-04-03T15:52:29Z |

### Steps

<hr/>

**Step 1**

> <article>Create a subscription that will post if pipeline fails or succeed<br><br>1. /circleci subscription add --project gh/DHaussermann/mattermost-plugin-custom-attributes <br>2. Follow steps here <a href="https://circleci.com/developer/orbs/orb/nathanaelhoun/mattermost-plugin-notify">https://circleci.com/developer/orbs/orb/nathanaelhoun/mattermost-plugin-notify</a> to add an orb to your project pipeline (or use the Custom attributes project)

<br>3. As instructed, add the environment variable for the webhook to your project </article>

**Expected**

> <article>On 1. The plugin shows:<br><em>"1. Setup the Mattermost Plugin Notify Orb for your CircleCI project <br>2. Add the MM_WEBHOOK environment variable to your project using the CircleCI UI or withPost confirms that project has been successfully set"</em><br>On 3. /circleci project env add MM_WEBHOOK <a href="https://dkh-5-33-release.test.mattermost.cloud/plugins/com.github.mattermost.plugin-circleci/hooks/AXwbcu5XAgCyXWx0pUnD_V42CZLC5yFQ">https://&lt;MM URL&gt;/plugins/com.github.mattermost.plugin-circleci/hooks/AXwbcu5XAgCyXWx0pUnD_V42CZLC5yFQ</a></article>

<hr/>

**Step 2**

> <article>Trigger a passing build<br>1. /circleci pipeline trigger branch master<br>2. Confirm that the expected build is running on the Circle Ci side<br>3. Wait for the build to succeed&nbsp;</article>

**Expected**

> <article>Subscription post is show with data about passing build in the channel from step 1.<br><img src="https://smartbear-tm4j-prod-us-west-2-attachment-rich-text.s3.us-west-2.amazonaws.com/embedded-f3277290f945470c4add5d21ef3dc7ca7b74388fc7152bfb6b99ae58c66a95a8-1617466205706-1617466205706.png" style="width: 300px;" class="fr-fic fr-fil fr-dib"></article>

<hr/>

**Step 3**

> <article>Trigger a failing build (by invalidating yml configuration)<br>1. In GitHub navigate to https://github.com/DHaussermann/mattermost-plugin-custom-attributes/tree/master/.circleci and edit <em>config.yml</em><br>2. Edit line <em><strong>116</strong></em> to read <em>`name: Building Plugin <strong>hippo-</strong>Bundle`&nbsp;</em><br>3. Edit line <strong>121</strong> to read <em>`<strong>hippo-</strong>printf "Supported Mattermost Server Versions: **$(cat plugin.json | jq .min_server_version -r)+** \n## Enhancements\n\n## Fixes\n" &gt;&gt; dist/release-notes.md</em><br>4. Push the commit to <em>master</em>&nbsp; (Or open a PR than merge it to <em>master</em> if you lack permissions)<br>5. Return to Mattermost and type <em>/circleci pipeline trigger branch master</em><br>6. Confirm that the expected build is running on the Circle Ci side<br>7. Wait for the build to fail<br><br><br><br></article>

**Test Data**

> <article><strong>Note:&nbsp;</strong><br>For steps 2. and 3. - Revert this commit after to make the build succeed again</article>

**Expected**

> <article>Subscription post is show with data about failing build.<br><img src="https://smartbear-tm4j-prod-us-west-2-attachment-rich-text.s3.us-west-2.amazonaws.com/embedded-f3277290f945470c4add5d21ef3dc7ca7b74388fc7152bfb6b99ae58c66a95a8-1617466892719-1617466892719.png" style="width: 300px;" class="fr-fic fr-fil fr-dib"></article>

<hr/>

**Step 4**

> <article>Delete a subscription<br>1. /circleci subscription remove --project gh/DHaussermann/mattermost-plugin-custom-attributes<br>2. /circleci subscription list<br><br></article>

**Expected**

> <article>Subscription is not shown</article>

<hr/>

**Step 5**

> <article>Subscribing to "Failed build only" shows failed builds<br>1. <em>/circleci subscription add --only-failed</em><br>2. <em>/circleci pipeline trigger branch master</em><br>3. Verify in Circle CI that the pipeline is running<br>4. Wait for the build to fail<br>5. Return to the Mattermost channel</article>

**Expected**

> <article>Subscription post is show with data about failing build.<br><img src="https://smartbear-tm4j-prod-us-west-2-attachment-rich-text.s3.us-west-2.amazonaws.com/embedded-f3277290f945470c4add5d21ef3dc7ca7b74388fc7152bfb6b99ae58c66a95a8-1617466892719-1617466892719.png" class="fr-fic fr-dii"><br></article>

**Step Info**
| Name | Value |
| :--- | :--- |
| Important notes about this step | Build should still be in a failing state from commit made in step 3. |

<hr/>

**Step 6**

> <article>Subscribing to "Failed build only" does not show successful builds<br>1. Revert the commit made in step 3. so that the <em>config.yml</em> is once again valid<br>2. Ensure the subscription created in step 5. is still in place<br>3. Type <em>/circleci pipeline trigger branch master</em><br>3. Verify in Circle CI that the pipeline is running<br>4. Wait for the build tosucceed<br>5. Return to the Mattermost channel</article>

**Expected**

> <article>The subscription did <strong>not </strong>make a post<br><br></article>

**Step Info**
| Name | Value |
| :--- | :--- |
| Important notes about this step | Build should still be in a failing state from commit made in step 3. |

<hr/>

### More Info

| Name     | Value        |
| :------- | :----------- |
| Tags     | Never tested |
| Location | Plugins      |
